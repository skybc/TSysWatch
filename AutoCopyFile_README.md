# 自动拷贝图片功能使用说明

## 功能简介
`AutoCopyFile` 类提供了自动拷贝图片文件的功能，支持：
- 从INI配置文件读取拷贝任务配置
- 递归扫描源目录下的所有图片文件
- 保持目录结构不变地拷贝到目标目录
- **重要功能**：将已处理的源文件移动到指定目录或删除，避免重复处理
- **证据保留**：每天生成详细的操作记录文件，记录所有拷贝和移动操作
- 支持多个拷贝任务配置

## 配置文件格式
创建 `AutoCopyFile.ini` 文件，格式如下：

```ini
# 自动拷贝文件配置
# 支持配置多个拷贝任务，每个任务使用[CopyTask]开始

[CopyTask]
# 源目录 - 要拷贝的图片文件所在目录
SourceDirectory=D:\Photos
# 目标目录 - 拷贝到的目标目录
TargetDirectory=E:\Backup\Photos
# 已拷贝文件移动目录 - 拷贝完成后将源文件移动到此目录（可选）
# 如果不设置此项，源文件将被删除
MovedDirectory=D:\Photos_Processed

# 可以添加更多拷贝任务
[CopyTask]
SourceDirectory=C:\Images
TargetDirectory=D:\Backup\Images
MovedDirectory=C:\Images_Processed
```

## 支持的图片格式
- `.jpg`, `.jpeg`
- `.png`
- `.bmp`
- `.gif`
- `.tiff`, `.tif`
- `.webp`
- `.ico`

## 新的工作流程与记录系统
1. **扫描源目录**：递归查找所有图片文件
2. **创建当日记录文件**：在源目录生成格式为 `拷贝记录_YYYYMMDD.txt` 的记录文件
3. **拷贝文件**：将图片文件拷贝到目标目录，保持目录结构
4. **记录操作**：详细记录每个文件的拷贝、移动、删除操作
5. **处理源文件**：
   - 如果配置了`MovedDirectory`，将源文件移动到该目录
   - 如果未配置`MovedDirectory`，删除源文件
6. **下次运行时只处理新文件**：因为已处理的文件已被移动或删除

## 操作记录文件
每天在源目录下会生成一个操作记录文件，文件名格式：`拷贝记录_YYYYMMDD.txt`

### 记录文件内容示例：
```txt
时间,操作类型,源文件路径,目标文件路径,文件大小(字节),状态
2025-01-19 10:30:15,拷贝,D:\Photos\IMG001.jpg,E:\Backup\Photos\IMG001.jpg,2048576,成功
2025-01-19 10:30:16,移动,D:\Photos\IMG001.jpg,D:\Photos_Processed\IMG001.jpg,2048576,成功
2025-01-19 10:30:17,跳过拷贝,D:\Photos\IMG002.jpg,E:\Backup\Photos\IMG002.jpg,1536000,文件已存在且相同
2025-01-19 10:30:18,移动,D:\Photos\IMG002.jpg,D:\Photos_Processed\IMG002.jpg,1536000,成功
```

### 操作类型说明：
- **拷贝**：将文件从源目录拷贝到目标目录
- **移动**：将源文件移动到已处理目录
- **删除**：删除源文件（当未配置MovedDirectory时）
- **跳过拷贝**：目标文件已存在且相同，跳过拷贝操作

## 优势
1. **完整的操作证据**：每个文件的处理都有详细记录，便于审计和排错
2. **按日期分类记录**：每天一个记录文件，便于管理和查找
3. **无需重复扫描**：下次运行时只需处理新增的文件
4. **目录结构保持**：完整保持源目录的文件夹结构
5. **灵活的源文件处理**：可选择移动到指定目录或直接删除
6. **智能文件比较**：对于已存在的目标文件，会比较大小和修改时间
7. **详细的状态记录**：成功、失败、跳过等状态都有记录

## 使用方法

### 1. 自动启动（推荐）
程序启动时会自动调用 `AutoCopyFile.Start()`，无需手动操作。

### 2. 手动调用
```csharp
// 启动自动拷贝
AutoCopyFile.Start();

// 停止自动拷贝
AutoCopyFile.Stop();
```

## 配置选项说明
- **SourceDirectory**（必需）：源图片文件目录
- **TargetDirectory**（必需）：拷贝目标目录  
- **MovedDirectory**（可选）：
  - 如果设置：拷贝完成后将源文件移动到此目录
  - 如果不设置：拷贝完成后删除源文件

## 日志输出
程序运行过程中会通过 `LogHelper.Logger` 记录详细的操作日志：
- 配置文件读取状态
- 拷贝进度和结果
- 文件移动或删除操作
- 记录文件创建和写入
- 错误信息和异常详情

## 注意事项
1. **重要**：源文件在拷贝后会被移动或删除，请确保目标目录的备份安全性
2. 确保源目录存在且有读写权限
3. 确保目标目录和移动目录有写入权限
4. 如果目标目录不存在，程序会自动创建
5. 如果MovedDirectory不存在，程序会自动创建
6. 记录文件会被自动排除，不会被拷贝
7. 每天会生成新的记录文件，历史记录文件会被保留
8. 程序目前每10秒运行一次拷贝任务（可根据需要调整）

## 记录文件管理
- 记录文件按日期命名，便于管理和归档
- 历史记录文件不会被自动删除，需要手动清理
- 建议定期备份和清理历史记录文件
- 记录文件采用UTF-8编码，可用Excel等工具打开查看

## 性能特点
- **显著减少文件检索时间**：无需每次扫描和比较大量已处理文件
- **避免重复处理**：已处理文件被物理移动，不会再次被扫描
- **完整的操作追踪**：每个操作都有时间戳和状态记录
- **便于故障排查**：通过记录文件可以快速定位问题
