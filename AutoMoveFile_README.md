# 自动移动文件功能使用说明

## 功能简介
`AutoMoveFile` 类提供了自动移动文件的功能，支持：
- 从INI配置文件读取移动任务配置
- 递归扫描源目录下的所有文件（包括子目录）
- 保持目录结构不变地移动到目标目录
- 详细的操作记录，记录到"移动记录.txt"作为证据
- 自动处理文件名冲突（重名文件自动重命名）
- 支持多个移动任务配置

## 配置文件格式
创建 `AutoMoveFile.ini` 文件，格式如下：

```ini
# 自动移动文件配置
# 支持配置多个移动任务，每个任务使用[MoveTask]开始

[MoveTask]
# 移动根目录（源目录） - 要移动的文件所在目录
SourceDirectory=D:\MoveSource
# 目标目录 - 移动到的目标目录
TargetDirectory=E:\MoveTarget

# 可以添加更多移动任务
[MoveTask]
SourceDirectory=C:\TempFiles
TargetDirectory=D:\Archive
```

## 工作流程
1. **扫描源目录**：递归查找所有文件（排除"移动记录.txt"）
2. **创建移动记录文件**：在源目录创建或更新"移动记录.txt"
3. **移动文件**：将文件移动到目标目录，保持目录结构
4. **处理冲突**：如果目标文件已存在，自动生成新文件名（如：file(1).txt）
5. **记录操作**：详细记录每个文件的移动操作和结果

## 移动记录文件
在每个源目录下会创建一个"移动记录.txt"文件，记录所有移动操作。

### 记录文件内容示例：
```
=== 文件移动记录 ===
格式：[时间] 操作 - 源文件路径 => 目标文件路径 (文件大小)

[2025-07-19 14:30:15] 移动 - D:\MoveSource\document.pdf => E:\MoveTarget\document.pdf (1.23 MB) - 成功
[2025-07-19 14:30:16] 移动 - D:\MoveSource\子目录\image.jpg => E:\MoveTarget\子目录\image.jpg (856.45 KB) - 成功
[2025-07-19 14:30:17] 移动 - D:\MoveSource\file.txt => E:\MoveTarget\file(1).txt (2.1 KB) - 成功
[2025-07-19 14:30:18] 移动 - D:\MoveSource\data.xlsx => 失败 (1.5 MB) - 文件被占用
```

## 功能特点
1. **完整目录扫描**：包括所有子目录中的文件
2. **目录结构保持**：完整保持源目录的文件夹结构
3. **智能文件重命名**：自动处理重名文件冲突
4. **详细操作记录**：记录时间戳、文件路径、大小、状态等
5. **文件大小格式化**：自动转换为易读的格式（B, KB, MB, GB, TB）
6. **完善的异常处理**：记录失败原因，便于排错
7. **多任务支持**：支持配置多个不同的移动任务

## 使用方法

### 1. 自动启动（推荐）
程序启动时会自动调用 `AutoMoveFile.Start()`，无需手动操作。

### 2. 手动调用
```csharp
// 启动自动移动功能
AutoMoveFile.Start();

// 停止自动移动功能
AutoMoveFile.Stop();
```

## 配置选项说明
- **SourceDirectory**（必需）：要移动的文件所在的根目录
- **TargetDirectory**（必需）：文件移动的目标目录

## 文件排除规则
- 自动排除"移动记录.txt"文件，避免移动记录文件本身

## 冲突处理机制
当目标位置已存在同名文件时，系统会自动生成新的文件名：
- 原文件：`document.txt`
- 冲突时：`document(1).txt`
- 再次冲突：`document(2).txt`
- 以此类推...

## 日志输出
程序运行过程中会通过 `LogHelper.Logger` 记录详细的操作日志：
- 配置文件读取状态
- 移动任务执行进度
- 移动操作结果
- 错误信息和异常详情

## 执行频率
- 程序每10秒执行一次移动任务检查
- 每次执行时会重新读取配置文件
- 可根据需要调整执行频率

## 注意事项
1. **重要**：文件移动是不可逆操作，请确保目标目录正确
2. 确保源目录存在且有读写权限
3. 确保目标目录有写入权限
4. 如果目标目录不存在，程序会自动创建
5. 移动记录文件不会被移动，始终保留在源目录
6. 移动操作会保持文件的修改时间等属性
7. 如果移动失败，原文件会保留在源目录

## 性能特点
- 高效的文件扫描和移动操作
- 自动处理大文件移动
- 完整的操作审计跟踪
- 智能的文件名冲突解决

## 适用场景
- 定期整理临时文件
- 自动归档文档
- 文件分类整理
- 数据迁移和备份预处理
