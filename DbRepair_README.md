# DbRepair数据库修复功能使用说明

## 功能简介
`DbRepair` 类提供了数据库自动修复功能，支持：
- 从INI配置文件读取是否启用该功能
- 定期检查数据库连接状态
- 自动执行数据库修复操作
- 完善的日志记录和异常处理

## 配置文件格式
创建 `DbRepair.ini` 文件，格式如下：

```ini
# DbRepair数据库修复功能配置
# 是否启用数据库修复功能，true=启用，false=禁用
Enabled=true
```

## 配置选项说明
- **Enabled**：控制是否启用DbRepair功能
  - `true`：启用数据库修复功能（默认）
  - `false`：禁用数据库修复功能

## 工作原理
1. **启动时检查配置**：程序启动时会读取配置文件，如果禁用则不运行修复功能
2. **定期健康检查**：每小时执行一次数据库连接测试
3. **自动修复**：当检测到需要修复的数据库错误时，自动执行修复操作
4. **日志记录**：记录所有操作和异常信息

## 使用方法

### 1. 自动启动（推荐）
程序启动时会自动调用 `DbRepair.Start()`，无需手动操作。

### 2. 手动调用
```csharp
// 启动数据库修复功能
DbRepair.Start();

// 停止数据库修复功能
DbRepair.Stop();
```

## 日志输出
程序运行过程中会通过 `LogHelper.Logger` 记录详细的操作日志：
- 配置文件读取状态
- 功能启用/禁用状态
- 数据库检查结果
- 修复操作执行情况
- 错误信息和异常详情

## 默认行为
- 如果配置文件不存在，程序会自动创建默认配置（启用状态）
- 如果读取配置失败，默认启用该功能
- 检查频率：每小时执行一次数据库健康检查

## 数据库配置
当前配置连接到MySQL数据库：
- 服务器：127.0.0.1:3306
- 数据库：sgamma_result
- 用户：root
- 检查表：t_dataitems

## 注意事项
1. 确保数据库服务正常运行
2. 确保数据库用户有足够的权限执行修复操作
3. 配置文件修改后需要重启程序才能生效
4. 修复操作会在后台定期执行，不会影响主程序运行
5. 如果不需要数据库修复功能，可以将Enabled设置为false

## 性能影响
- 每小时只执行一次检查，对系统性能影响很小
- 只有在检测到数据库异常时才执行修复操作
- 在禁用状态下不会消耗任何系统资源
